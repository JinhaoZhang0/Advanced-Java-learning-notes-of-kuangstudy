# Redis

## 1. NoSQL 概述

### 1.1 为什么使用NoSQL

#### 1. 单机Mysql时代

<img src="images/562.jpg" alt="562" style="zoom:50%;" />

90年代,一个网站的访问量一般不会太大，单个数据库完全够用。随着用户增多，网站出现以下问题

1. 数据量增加到一定程度，单机数据库就放不下了
2. 数据的索引（B+ Tree）,一个机器内存也存放不下（MySQL超过300万条数据就一定要建立索引！）
3. 访问量变大后（读写混合），一台服务器承受不住。

#### 2. Memcached(缓存) + Mysql + 垂直拆分（读写分离）

网站80%的情况都是在读，每次都要去查询数据库的话就十分的麻烦！所以说我们希望减轻数据库的压力，我们可以使用缓存来保证效率！

<img src="images/563.jpg" alt="563" style="zoom:40%;" />

优化过程经历了以下几个过程：

1. 优化数据库的数据结构和索引(难度大)
2. 文件缓存，通过IO流获取比每次都访问数据库效率略高，但是流量爆炸式增长时候，IO流也承受不了
3. MemCache,当时最热门的技术，通过在数据库和数据库访问层之间加上一层缓存，第一次访问时查询数据库，将结果保存到缓存，后续的查询先检查缓存，若有直接拿去使用，效率显著提升。

#### 3. 分库分表 + 水平拆分 + Mysql集群

技术和业务在发展的同时，对人的要求也越来越高了

==本质：数据库（读，写）==

早些年MyISAM: 表锁，十分影响效率！高并发下就会出现严重的锁问题！

转战InnoDB：行锁

慢慢的就开始使用分库分表来解决写的压力！MySQL于是推出了表分区（这个并没有多少公司使用）

MySQL的集群，很好满足那个年代的需求！

<img src="images/564.jpg" alt="564" style="zoom:38%;" />

#### 4. 如今的年代(NoSQL)

 如今信息量井喷式增长，各种各样的数据出现（用户定位数据，图片数据，热榜等），大数据的背景下关系型数据库（RDBMS）无法满足大量数据要求。Nosql数据库就能轻松解决这些问题。

目前一个基本的互联网项目

<img src="images/565.jpg" alt="565" style="zoom:40%;" />

#### 5. 为什么要用NoSQL ？

用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！
这时候我们就需要使用NoSQL数据库的，NoSQL可以很好的处理以上的情况！

### 1.2 什么是Nosql

==NoSQL = Not Only SQL（不仅仅是SQL）==

Not Only Structured Query Language

关系型数据库：列+行，同一个表下数据的结构是一样的。

非关系型数据库：数据存储没有固定的格式，并且可以进行横向扩展。

NoSQL泛指非关系型数据库，随着web2.0互联网的诞生，传统的关系型数据库很难对付web2.0时代！尤其是超大规模的高并发的社区，暴露出来很多难以克服的问题，NoSQL在当今大数据环境下发展的十分迅速，Redis是发展最快的。

很多的数据类型用户的个人信息，社交网络，地理位置，这些数据类型的存储不需要一个固定的格式！不需要多月的操作就可以横向发展！

### 1.3 Nosql特点

1. 方便扩展（数据之间没有关系，很好扩展！）
2. 大数据量高性能（Redis一秒可以写8万次，读11万次，NoSQL的缓存记录级，是一种细粒度的缓存，性能会比较高！）
3. 数据类型是多样型的！（不需要事先设计数据库，随取随用）
4. 传统的 RDBMS 和 NoSQL

```
传统的 RDBMS(关系型数据库)
- 结构化组织
- SQL
- 数据和关系都存在单独的表中 row col
- 操作，数据定义语言
- 严格的一致性
- 基础的事务
- ...
```

 ```
 Nosql
 - 不仅仅是数据
 - 没有固定的查询语言
 - 键值对存储，列存储，文档存储，图形数据库（社交关系）
 - 最终一致性
 - CAP定理和BASE
 - 高性能，高可用，高扩展
 - ...
 ```

### 1.4 了解：3V + 3高

大数据时代的3V ：主要是**描述问题**的

1. 海量Volume
2. 多样Variety
3. 实时Velocity

大数据时代的3高 ： 主要是**对程序的要求**

1. 高并发
2. 高可扩
3. 高性能

真正在公司中的实践：NoSQL + RDBMS 一起使用才是最强的。

### 阿里巴巴演进分析

推荐阅读：阿里云的这群疯子https://yq.aliyun.com/articles/653511

<img src="images/566.png" alt="566" style="zoom:55%;" />

<img src="images/567.png" alt="567" style="zoom:50%;" />

如果未来当架构师：没有什么是加一层解决不了的！

```bash
# 商品信息
- 一般存放在关系型数据库：Mysql,阿里巴巴使用的Mysql都是经过内部改动的。

# 商品描述、评论(文字居多)
- 文档型数据库：MongoDB

# 图片
- 分布式文件系统 FastDFS
- 淘宝：TFS
- Google: GFS
- Hadoop: HDFS
- 阿里云: oss

# 商品关键字 用于搜索
- 搜索引擎：solr,elasticsearch
- 阿里：Isearch 多隆

# 商品热门的波段信息
- 内存数据库：Redis，Memcache

# 商品交易，外部支付接口
- 第三方应用
```

一个简单的网页背后的技术一定不是想象的这么简单！

大型互联网应用问题：

* 数据类型太多了
* 数据源太多了，经常重构！
* 数据要改造，大面积改造麻烦！

### 1.5 NoSQL的四大分类

#### 1. **KV键值对**

- 新浪：**Redis**
- 美团：Redis + Tair
- 阿里、百度：Redis + Memcache

#### 2. 文档型数据库（bson数据格式）：

* **MongoDB**(掌握)
  * 基于分布式文件存储的数据库。C++编写，用于处理大量文档。
  * MongoDB是RDBMS和NoSQL的中间产品。MongoDB是非关系型数据库中功能最丰富的，NoSQL中最像关系型数据库的数据库。
* ConthDB

#### 3. **列存储数据库**

- **HBase**(大数据必学)
- 分布式文件系统

#### 4. **图关系数据库**

用于广告推荐，社交网络

- **Neo4j**、InfoGrid

| **分类**                | **Examples举例**                                   | **典型应用场景**                                             | **数据模型**                                    | **优点**                                                     | **缺点**                                                     |
| ----------------------- | -------------------------------------------------- | ------------------------------------------------------------ | ----------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **键值对（key-value）** | Tokyo Cabinet/Tyrant, Redis, Voldemort, Oracle BDB | 内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等。 | Key 指向 Value 的键值对，通常用hash table来实现 | 查找速度快                                                   | 数据无结构化，通常只被当作字符串或者二进制数据               |
| **列存储数据库**        | Cassandra, HBase, Riak                             | 分布式的文件系统                                             | 以列簇式存储，将同一列数据存在一起              | 查找速度快，可扩展性强，更容易进行分布式扩展                 | 功能相对局限                                                 |
| **文档型数据库**        | CouchDB, MongoDb                                   | Web应用（与Key-Value类似，Value是结构化的，不同的是数据库能够了解Value的内容） | Key-Value对应的键值对，Value为结构化数据        | 数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构 | 查询性能不高，而且缺乏统一的查询语法。                       |
| **图形(Graph)数据库**   | Neo4J, InfoGrid, Infinite Graph                    | 社交网络，推荐系统等。专注于构建关系图谱                     | 图结构                                          | 利用图结构相关算法。比如最短路径寻址，N度关系查找等          | 很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群 |



## 2. Redis入门

### 2.1 概述

#### 1. Redis是什么？

Redis（Remote Dictionary Server )，即远程字典服务。

是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、**Key-Value数据库**，并提供多种语言的API。

与memcached一样，为了保证效率，**数据都是缓存在内存中**。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。

#### 2. Redis能该干什么？

1. 内存存储、持久化，内存是断电即失的，所以需要持久化（RDB、AOF）
2. 高效率、用于高速缓冲
3. 发布订阅系统
4. 地图信息分析
5. 计时器、计数器(eg：浏览量)
6. 。。。

#### 3. 特性

1. 多样的数据类型

2. 持久化

3. 集群

4. 事务

   …

### 2.2 环境搭建

官网：https://redis.io/

推荐使用Linux服务器学习。

windows版本的Redis已经停更很久了…

#### 1. Windows安装

https://github.com/dmajkic/redis

1. 解压安装包

<img src="images/568.png" alt="568" style="zoom:50%;" />

2. 开启redis-server.exe
3. 启动redis-cli.exe测试

<img src="images/569.png" alt="569" style="zoom:60%;" />